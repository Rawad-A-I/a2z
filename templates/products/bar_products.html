{% extends "base/bar_base.html" %}
{% load static %}

{% block title %}A2Z Bar - All Drinks{% endblock %}

{% block content %}
<div class="container">
  <!-- Back Button -->
  <div class="mb-4">
    <a href="{% url 'bar_home' %}" class="btn btn-outline">
      <i class="fas fa-arrow-left"></i> Back to Bar Home
    </a>
  </div>

  <!-- Filter Section -->
  <div class="mb-6">
    <form method="GET" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      <div class="form-group">
        <label for="category" class="form-label">Category:</label>
        <select id="category" name="category" class="form-control" onchange="this.form.submit()">
          <option value="">All Categories</option>
          {% for category in categories %}
          <option value="{{ category.category_name }}" {% if selected_category == category.category_name %} selected {% endif %}>
            {{ category.category_name }}
          </option>
          {% endfor %}
        </select>
      </div>
      
      <div class="form-group">
        <label for="sort" class="form-label">Sort by:</label>
        <select id="sort" name="sort" class="form-control" onchange="this.form.submit()">
          <option value="">Select</option>
          <option value="newest" {% if selected_sort == 'newest' %}selected{% endif %}>Newest</option>
          <option value="priceAsc" {% if selected_sort == 'priceAsc' %}selected{% endif %}>Price: Low-High</option>
          <option value="priceDesc" {% if selected_sort == 'priceDesc' %}selected{% endif %}>Price: High-Low</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="search" class="form-label">Search:</label>
        <input type="text" id="search" name="q" class="form-control" placeholder="Search drinks..." value="{{ query|default:'' }}">
      </div>
    </form>
  </div>

  <!-- Products Grid -->
  <div class="responsive-product-grid">
    {% for product in products %}
    <div class="product-card-mobile" data-product-id="{{ product.id }}">
      <div class="product-image-container">
        <a href="{% url 'bar_product_detail' product.slug %}" class="product-image-link">
          {% if product.product_images.first %}
            <img src="/media/{{product.product_images.first.image}}" 
                 class="product-image-mobile"
                 loading="lazy" 
                 alt="{{ product.product_name }}"
                 width="280" height="280" />
          {% else %}
            <div class="product-image-placeholder">
              <i class="fas fa-wine-bottle"></i>
            </div>
          {% endif %}
        </a>
        
        <!-- Product Badges -->
        <div class="product-badges">
          {% if not product.is_in_stock %}
            <span class="badge badge-out-of-stock">Out of Stock</span>
          {% elif product.stock_quantity > 0 and product.is_low_stock %}
            <span class="badge badge-warning">Low Stock</span>
          {% elif product.is_new_arrival %}
            <span class="badge badge-new">New</span>
          {% elif product.is_bestseller %}
            <span class="badge badge-bestseller">Popular</span>
          {% endif %}
        </div>
      </div>
      
      <div class="product-info-mobile">
        <h3 class="product-title-mobile">
          <a href="{% url 'bar_product_detail' product.slug %}" class="product-title-link">
            {{ product.product_name|truncatechars:50 }}
          </a>
        </h3>
        
        <div class="product-category">
          <span class="category-badge">{{ product.category.category_name }}</span>
        </div>
        
        <div class="product-price-container">
          <span class="product-price-mobile">${{ product.price }}</span>
        </div>
        
        <div class="product-actions">
          <a href="{% url 'bar_product_detail' product.slug %}" class="btn btn-outline">
            <i class="fas fa-eye"></i>
            <span>View Details</span>
          </a>
          
          {% if product.is_in_stock %}
            <a href="{% url 'add_to_bar_cart' product.uid %}" class="btn btn-primary">
              <i class="fas fa-shopping-cart"></i>
              <span>Add to Cart</span>
            </a>
          {% else %}
            <button class="btn btn-secondary" disabled>
              <i class="fas fa-times"></i>
              <span>Out of Stock</span>
            </button>
          {% endif %}
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12">
      <div class="text-center py-8">
        <i class="fas fa-wine-bottle text-6xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-medium text-gray-900 mb-2">No drinks found</h3>
        <p class="text-gray-500 mb-4">Try adjusting your search or filter criteria.</p>
        <a href="{% url 'bar_products' %}" class="btn btn-primary">
          <i class="fas fa-refresh"></i> View All Drinks
        </a>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if products.has_other_pages %}
  <nav aria-label="Page navigation" class="mt-6">
    <ul class="pagination justify-content-center">
      {% if products.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ products.previous_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_sort %}&sort={{ selected_sort }}{% endif %}{% if query %}&q={{ query }}{% endif %}">
          <i class="fas fa-chevron-left"></i> Previous
        </a>
      </li>
      {% endif %}
      
      {% for num in products.paginator.page_range %}
        {% if products.number == num %}
        <li class="page-item active">
          <span class="page-link">{{ num }}</span>
        </li>
        {% elif num > products.number|add:'-3' and num < products.number|add:'3' %}
        <li class="page-item">
          <a class="page-link" href="?page={{ num }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_sort %}&sort={{ selected_sort }}{% endif %}{% if query %}&q={{ query }}{% endif %}">{{ num }}</a>
        </li>
        {% endif %}
      {% endfor %}
      
      {% if products.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ products.next_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_sort %}&sort={{ selected_sort }}{% endif %}{% if query %}&q={{ query }}{% endif %}">
          Next <i class="fas fa-chevron-right"></i>
        </a>
      </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>

<style>
  @media (max-width: 768px) {
    .container {
      padding: 0.5rem;
    }
    
    .btn {
      min-height: 44px;
      font-size: 1rem;
      padding: 0.75rem 1rem;
    }
    
    .form-control {
      font-size: 16px; /* Prevents zoom on iOS */
    }
    
    .product-actions .btn {
      width: 100%;
      margin-bottom: 0.5rem;
    }
  }
</style>
{% endblock %}